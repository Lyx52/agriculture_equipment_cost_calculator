const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/editingSupport-BXAZC5As.js","assets/index-DhSvwCRD.js","assets/index-ySLq0dEO.css","assets/EditBusLayer-Dr0DxKOH.js","assets/infoFor3D-CxdEiWhp.js"])))=>i.map(i=>d[i]);
import{fl as y,bw as P,fm as j,fn as L,s as i,_ as F,fo as E,fp as x,fq as R,fr as q,fs as A,d1 as S,ft as C,fu as _,fv as M,J as m,fw as T}from"./index-DhSvwCRD.js";import{p as $}from"./jsonUtils-x6RFphAc.js";import{A as D}from"./UniqueValueRenderer-BRtlhK9V.js";async function G(t,e,r){e=e.clone(),t.capabilities.query.supportsMaxRecordCountFactor&&(e.maxRecordCountFactor=v(t));const n=V(t),o=t.capabilities.query.supportsPagination;e.start=0,e.num=n;let a=null;for(;;){const s=await t.source.queryFeaturesJSON(e,r);if(a==null?a=s:a.features=a.features.concat(s.features),a.exceededTransferLimit=s.exceededTransferLimit,!o||!s.exceededTransferLimit)break;e.start+=n}return a}function V(t){return v(t)*N(t)}function N(t){return t.capabilities.query.maxRecordCount||2e3}function v(t){return t.capabilities.query.supportsMaxRecordCountFactor?y.MAX_MAX_RECORD_COUNT_FACTOR:1}const X=new P({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch"});async function z(t,e,r,n){const o=await f(t);if(await w(t,e,n),!o.addAttachment)throw new i(n,"Layer source does not support addAttachment capability");return o.addAttachment(e,r)}function w(t,e,r){var a,s;const{attributes:n}=e,{objectIdField:o}=t;return(s=(a=t.capabilities)==null?void 0:a.data)!=null&&s.supportsAttachment?e?n?o&&n[o]?Promise.resolve():Promise.reject(new i(r,`feature is missing the identifying attribute ${o}`)):Promise.reject(new i(r,"'attributes' are required on a feature to query attachments")):Promise.reject(new i(r,"A feature is required to add/delete/update attachments")):Promise.reject(new i(r,"this layer doesn't support attachments"))}async function K(t,e,r,n,o){const a=await f(t);if(await w(t,e,o),!a.updateAttachment)throw new i(o,"Layer source does not support updateAttachment capability");return a.updateAttachment(e,r,n)}async function W(t,e,r){const{applyEdits:n}=await F(()=>import("./editingSupport-BXAZC5As.js"),__vite__mapDeps([0,1,2,3,4])),o=await t.load();let a=r;return o.type==="feature"&&o.infoFor3D&&e.deleteFeatures!=null&&o.globalIdField!=null&&(a={...a,globalIdToObjectId:await k(o,e.deleteFeatures,o.globalIdField)}),n(o,o.source,e,r)}async function Y(t,e,r){const{uploadAssets:n}=await F(()=>import("./editingSupport-BXAZC5As.js"),__vite__mapDeps([0,1,2,3,4])),o=await t.load();return n(o,o.source,e,r)}async function tt(t,e,r,n){const o=await f(t);if(await w(t,e,n),!o.deleteAttachments)throw new i(n,"Layer source does not support deleteAttachments capability");return o.deleteAttachments(e,r)}async function et(t,e,r){const n=(await t.load({signal:e==null?void 0:e.signal})).source;if(!n.fetchRecomputedExtents)throw new i(r,"Layer source does not support fetchUpdates capability");return n.fetchRecomputedExtents(e)}async function nt(t,e,r,n){var g,I;e=E.from(e),await t.load();const o=t.source,a=t.capabilities;if(!((g=a==null?void 0:a.data)!=null&&g.supportsAttachment))throw new i(n,"this layer doesn't support attachments");const{attachmentTypes:s,objectIds:u,globalIds:c,num:l,size:p,start:d,where:b}=e;if(!((I=a==null?void 0:a.operations)!=null&&I.supportsQueryAttachments)&&((s==null?void 0:s.length)>0||(c==null?void 0:c.length)>0||(p==null?void 0:p.length)>0||l||d||b))throw new i(n,"when 'capabilities.operations.supportsQueryAttachments' is false, only objectIds is supported",e);if(!(u!=null&&u.length||c!=null&&c.length||b))throw new i(n,"'objectIds', 'globalIds', or 'where' are required to perform attachment query",e);if(!o.queryAttachments)throw new i(n,"Layer source does not support queryAttachments capability",e);return o.queryAttachments(e)}async function rt(t,e,r,n){const o=await f(t);if(!o.queryObjectIds)throw new i(n,"Layer source does not support queryObjectIds capability");return o.queryObjectIds(y.from(e)??t.createQuery(),r)}async function ot(t,e,r,n){const o=await f(t);if(!o.queryFeatureCount)throw new i(n,"Layer source does not support queryFeatureCount capability");return o.queryFeatureCount(y.from(e)??t.createQuery(),r)}async function at(t,e,r,n){const o=await f(t);if(!o.queryExtent)throw new i(n,"Layer source does not support queryExtent capability");return o.queryExtent(y.from(e)??t.createQuery(),r)}async function st(t,e,r,n){const o=await f(t);if(!o.queryRelatedFeatures)throw new i(n,"Layer source does not support queryRelatedFeatures capability");return o.queryRelatedFeatures(x.from(e),r)}async function it(t,e,r,n){const o=await f(t);if(!o.queryRelatedFeaturesCount)throw new i(n,"Layer source does not support queryRelatedFeaturesCount capability");return o.queryRelatedFeaturesCount(x.from(e),r)}async function ut(t){const e=t.source;if(e!=null&&e.refresh)try{const{dataChanged:r,updates:n}=await e.refresh();if(n!=null&&(t.sourceJSON={...t.sourceJSON,...n},t.read(n,{origin:"service",url:t.parsedUrl})),r)return!0}catch{}if(t.definitionExpression)try{return(await R(t.definitionExpression,t.fieldsIndex)).hasDateFunctions}catch{}return!1}function ct(t){var s,u;const e=new y,r=(s=t.capabilities)==null?void 0:s.data,n=(u=t.capabilities)==null?void 0:u.query;e.historicMoment=t.historicMoment,e.gdbVersion=t.gdbVersion,e.returnGeometry=!0,n&&(e.compactGeometryEnabled=n.supportsCompactGeometry,e.defaultSpatialReferenceEnabled=n.supportsDefaultSpatialReference),r&&(r.supportsZ&&t.returnZ!=null&&(e.returnZ=t.returnZ),r.supportsM&&t.returnM!=null&&(e.returnM=t.returnM)),e.outFields=["*"];const{timeOffset:o,timeExtent:a}=t;return e.timeExtent=o!=null&&a!=null?a.offset(-o.value,o.unit):a||null,e.multipatchOption=t.geometryType==="multipatch"?"xyFootprint":null,e}function lt(t){const{globalIdField:e,fields:r}=t;if(e)return e;if(r){for(const n of r)if(n.type==="esriFieldTypeGlobalID")return n.name}}function pt(t){const{objectIdField:e,fields:r}=t;if(e)return e;if(r){for(const n of r)if(n.type==="esriFieldTypeOID")return n.name}}function dt(t){return t.currentVersion?t.currentVersion:t.hasOwnProperty("capabilities")||t.hasOwnProperty("drawingInfo")||t.hasOwnProperty("hasAttachments")||t.hasOwnProperty("htmlPopupType")||t.hasOwnProperty("relationships")||t.hasOwnProperty("timeInfo")||t.hasOwnProperty("typeIdField")||t.hasOwnProperty("types")?10:9.3}function ft(t,e){const{subtypes:r,subtypeField:n}=t;if(!(e!=null&&e.attributes)||!(r!=null&&r.length)||!n)return null;const o=e.attributes[n];return o==null?null:r.find(a=>a.code===o)}function yt(t,e){var s,u;const{fieldsIndex:r,subtypeField:n}=t,{name:o,type:a}=r.get(e)??{};if(!o)return null;if((n&&((s=r.get(n))==null?void 0:s.name))===o&&((u=t.subtypes)!=null&&u.length)){const c=t.subtypes.map(l=>new q({code:O(l.code,a),name:l.name}));if(c!=null&&c.length)return new A({codedValues:c})}return null}function mt(t,e){var a,s;const{fieldsIndex:r}=t,{name:n,type:o}=r.get(e)??{};if(!n)return null;if(("typeIdField"in t?(a=r.get(t.typeIdField))==null?void 0:a.name:null)===n&&"types"in t&&((s=t.types)!=null&&s.length)){const u=t.types.map(c=>new q({code:O(c.id,o),name:c.name}));return new A({codedValues:u})}return null}function O(t,e){return e?S({type:e})&&typeof t=="number"?`${t}`:C({type:e})&&typeof t=="string"?Number.parseInt(t,10):t:t}async function f(t){return(await t.load()).source}async function J(t,e){if(!m||m.findCredential(t))return;let r;try{const n=await T(t,e);n&&(r=await m.checkSignInStatus(`${n}/sharing`))}catch{}if(r)try{const n=e!=null?e.signal:null;await m.getCredential(t,{signal:n})}catch{}}async function ht(t,e,r){var o;const n=(o=t.parsedUrl)==null?void 0:o.path;n&&t.authenticationTriggerEvent===e&&await J(n,r)}function wt(t){return!Q(t)&&(t.userHasUpdateItemPrivileges||t.editingEnabled)}const h=j({types:L});function bt(t,e){var r;if(t.defaultSymbol)return(r=t.types)!=null&&r.length?new D({defaultSymbol:h(t.defaultSymbol,t,e),field:t.typeIdField,uniqueValueInfos:t.types.map(n=>({id:n.id,symbol:h(n.symbol,n,e)}))}):new $({symbol:h(t.defaultSymbol,t,e)})}function gt(t){var n,o,a;let e=(n=t.sourceJSON)==null?void 0:n.cacheMaxAge;if(!e)return!1;const r=(a=(o=t.editingInfo)==null?void 0:o.lastEditDate)==null?void 0:a.getTime();return r==null||(e*=1e3,Date.now()-r<e)}async function k(t,e,r){if(e==null)return null;const n=[],{objectIdField:o}=t;if(e.forEach(l=>{let p=null;if("attributes"in l){const{attributes:d}=l;p={globalId:d[r],objectId:d[o]!=null&&d[o]!==-1?d[o]:null}}else p={globalId:l.globalId,objectId:l.objectId!=null&&l.objectId!==-1?l.objectId:null};p.globalId!=null&&(p.objectId!=null&&p.objectId!==-1||n.push(p.globalId))}),n.length===0)return null;const a=t.createQuery();a.where=n.map(l=>`${r}='${l}'`).join(" OR "),a.returnGeometry=!1,a.outFields=[o,r],a.cacheHint=!1;const s=await _(G(t,a));if(!s.ok)return null;const u=new Map,c=s.value.features;for(const l of c){const p=l.attributes[r],d=l.attributes[o];p!=null&&d!=null&&d!==-1&&u.set(M(p),d)}return u}function It(t,e,r){if(!e||!r||!t)return null;const n=r.getAttribute(e);return n==null?null:t.find(o=>{const{id:a}=o;return a!=null&&a.toString()===n.toString()})??null}function Q(t){var e;return((e=t.sourceJSON)==null?void 0:e.isMultiServicesView)||U(t)}function U(t){var e,r;return!!((r=(e=t.sourceJSON)==null?void 0:e.capabilities)!=null&&r.toLowerCase().split(",").map(n=>n.trim()).includes("map"))}function Ft(t,e,r){const n=e==null?void 0:e.queryBins;if(!n)throw new i(r,"Layer source does not support binning");switch(t.binParameters.type){case"auto-interval":if(!n.supportsAutoInterval)throw new i(r,"Layer source does not support auto-interval binning");break;case"date":if(!n.supportsDate)throw new i(r,"Layer source does not support date binning");break;case"fixed-boundaries":if(!n.supportsFixedBoundaries)throw new i(r,"Layer source does not support fixed-boundaries binning");break;case"fixed-interval":if(!n.supportsFixedInterval)throw new i(r,"Layer source does not support fixed-interval binning")}const o=n==null?void 0:n.supportedStatistics;if(t.outStatistics&&o){const a=new Map([["count","count"],["sum","sum"],["min","min"],["max","max"],["avg","avg"],["stddev","stddev"],["var","var"],["percentile-continuous","percentileContinuous"],["percentile-discrete","percentileDiscrete"],["centroid-aggregate","centroid"],["convex-hull-aggregate","convexHull"],["envelope-aggregate","envelope"]]);for(const{statisticType:s}of t.outStatistics){const u=a.get(s);if(u&&!o[u])throw new i(r,`Layer source does not support ${s} statistic type`)}}}export{tt as A,gt as B,it as C,pt as D,at as E,K as F,dt as G,z as I,ht as J,k as K,st as L,ct as M,rt as O,ot as P,ft as Q,ut as R,nt as S,yt as T,mt as U,lt as V,It as W,Q as X,wt as Z,Ft as _,X as g,W as q,et as v,Y as x,bt as z};
